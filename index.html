<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Generador de Nota de Signatura</title>
  <style>
    *{box-sizing:border-box}
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:#f2f4f8; margin:0; padding:24px;
    }
    .container{
      max-width: 920px; margin:0 auto; background:#fff; padding:28px 24px;
      border-radius:16px; box-shadow:0 12px 40px rgba(16,24,40,.08);
    }
    h1{margin:0 0 6px; text-align:center; color:#1f2937; font-size:26px}
    .subtitle{margin:0 0 20px; text-align:center; color:#6b7280; font-size:14px}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:16px}
    .full{grid-column:1 / -1}
    label{display:block; font-weight:600; color:#111827; margin-bottom:6px; font-size:14px}
    input, select, textarea{
      width:100%; padding:12px; border:1.8px solid #e5e7eb; border-radius:10px; font-size:15px;
      font-family:inherit; background:#fff; outline:none; transition:border-color .2s;
    }
    textarea{min-height:140px; resize:vertical}
    input:focus, select:focus, textarea:focus{border-color:#6366f1}
    .section{background:#f9fafb; border:1px solid #eef2f7; padding:16px; border-radius:12px; margin:18px 0}
    .section h3{margin:0 0 10px; font-size:16px; color:#1f2937}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:12px 16px; border:none; border-radius:10px; cursor:pointer; font-weight:700;
      background:#6366f1; color:#fff; width:100%; font-size:16px;
      box-shadow:0 8px 20px rgba(99,102,241,.25); transition:transform .15s;
    }
    .btn:hover{transform:translateY(-1px)}
    .preview{margin-top:18px; display:none}
    .note{font-size:12px; color:#6b7280; margin-top:8px}
    @media (max-width: 760px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“‹ Generador de Nota de Signatura</h1>
    <p class="subtitle">Complete los campos y genere el PDF con membrete y pie institucional</p>

    <!-- DATOS -->
    <div class="section">
      <h3>Datos del Convenio</h3>
      <div class="grid">
        <div>
          <label>Fecha</label>
          <input type="date" id="fecha">
        </div>
        <div>
          <label>Provincia</label>
          <input type="text" id="provincia" placeholder="Ej: Santa Fe">
        </div>
        <div class="full">
          <label>Nombre del Convenio</label>
          <input type="text" id="nombreConvenio" placeholder="Ej: Convenio Colectivo de Trabajo - Industria...">
        </div>
        <div class="full">
          <label>NÃºmero de Convenio</label>
          <input type="text" id="numeroConvenio" placeholder="Ej: 260/75">
        </div>
      </div>
    </div>

    <!-- CUERPO -->
    <div class="section">
      <h3>Cuerpo de la Nota</h3>
      <div>
        <label>Texto</label>
        <textarea id="cuerpoNota" placeholder="Escriba el contenido principal de la nota..."></textarea>
      </div>
    </div>

    <!-- FIRMANTES -->
    <div class="section">
      <h3>Firmantes</h3>
      <div class="grid">
        <div>
          <label>Nombre del Auxiliar</label>
          <input type="text" id="auxiliar" placeholder="Nombre completo">
        </div>
        <div>
          <label>Nombre del Referente</label>
          <input type="text" id="referente" placeholder="Nombre completo">
        </div>
        <div class="full">
          <label>Nombre del Subgerente (opcional)</label>
          <input type="text" id="subgerente" placeholder="Dejar en blanco si no corresponde">
        </div>
        <div>
          <label>Nombre del Firmante del Convenio</label>
          <input type="text" id="firmante" placeholder="Nombre completo">
        </div>
        <div>
          <label>Correo electrÃ³nico del Firmante</label>
          <input type="email" id="firmanteEmail" placeholder="ejemplo@dominio.com">
        </div>
      </div>
    </div>

    <!-- CLONA -->
    <div class="section">
      <h3>CLONA</h3>
      <div class="grid">
        <div>
          <label>Â¿Corresponde?</label>
          <select id="clona" onchange="toggleClona()">
            <option value="NO">NO</option>
            <option value="SI">SI</option>
          </select>
        </div>
        <div class="full" id="clonaBox" style="display:none;">
          <label>Convenios relacionados (si corresponde)</label>
          <textarea id="conveniosClona" placeholder="Ej: CCT 123/75, CCT 456/80"></textarea>
        </div>
      </div>
    </div>

    <!-- TA -->
    <div class="section">
      <h3>TA (Tasa Acumulada)</h3>
      <label>NÃºmeros de TA</label>
      <input type="text" id="numerosTA" placeholder="Ej: TA-001, TA-002, TA-003">
    </div>

    <button class="btn" onclick="generarPDF()">ðŸ”„ Generar PDF</button>
    <div class="note">En el PDF solo se colocarÃ¡n los valores ingresados (sin etiquetas).</div>

    <div class="preview" id="preview">
      <p style="color:#10b981;font-weight:700;margin:10px 0 0">âœ… Documento listo. PodÃ©s descargarlo:</p>
      <button class="btn" style="background:#10b981;margin-top:8px" onclick="descargarPDF()">ðŸ“¥ Descargar PDF</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // âš ï¸ ReemplazÃ¡ estas URLs por las de tus imÃ¡genes (raw de GitHub)
    const HEADER_URL = "https://raw.githubusercontent.com/conveniosjerarquicos/nota-signatura/main/membrete.png";
    const FOOTER_URL = "https://raw.githubusercontent.com/conveniosjerarquicos/nota-signatura/main/pie.png";

    // jsPDF A4 (mm)
    const PAGE_W = 210, PAGE_H = 297;
    // Altos mÃ¡ximos (se respeta proporciÃ³n de la imagen, sin estirar)
    const HEADER_MAX_H = 18; // mÃ¡s chico que antes
    const FOOTER_MAX_H = 16;

    const MARGIN_X = 20;
    let HEADER_H = 14; // se recalcula con la relaciÃ³n de aspecto real
    let FOOTER_H = 12;

    function toggleClona(){
      const v = document.getElementById('clona').value;
      document.getElementById('clonaBox').style.display = (v === 'SI') ? 'block' : 'none';
    }

    // Precarga de imÃ¡genes y cÃ¡lculo de alto proporcional
    let headerImg=null, footerImg=null;
    function loadImage(src){
      return new Promise((res, rej)=>{
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload=()=>res(img);
        img.onerror=rej;
        img.src = src;
      });
    }
    (async function preload(){
      try{
        [headerImg, footerImg] = await Promise.all([loadImage(HEADER_URL), loadImage(FOOTER_URL)]);
        if (headerImg && headerImg.width) {
          const h = PAGE_W * (headerImg.height / headerImg.width);
          HEADER_H = Math.min(h, HEADER_MAX_H);
        }
        if (footerImg && footerImg.width) {
          const h = PAGE_W * (footerImg.height / footerImg.width);
          FOOTER_H = Math.min(h, FOOTER_MAX_H);
        }
      }catch(e){ console.warn("No se pudieron precargar las imÃ¡genes", e); }
    })();

    function addHeaderFooter(doc){
      if(headerImg){
        const h = HEADER_H;
        doc.addImage(headerImg, "PNG", 0, 0, PAGE_W, h);
      }
      if(footerImg){
        const h = FOOTER_H;
        doc.addImage(footerImg, "PNG", 0, PAGE_H - h, PAGE_W, h);
      }
    }

    function topY(){ return HEADER_H + 10; }
    function bottomY(){ return PAGE_H - FOOTER_H - 12; }

    function ensureSpace(doc, needed, yRef){
      if(yRef.value + needed > bottomY()){
        doc.addPage(); addHeaderFooter(doc); yRef.value = topY();
      }
    }

    function textBlock(doc, value, width, yRef, lineH=5){
      const val = (value || "").toString().trim();
      if(!val) return;
      const lines = doc.splitTextToSize(val, width);
      const h = lines.length * lineH + 1;
      ensureSpace(doc, h, yRef);
      doc.text(lines, MARGIN_X, yRef.value);
      yRef.value += h + 3;
    }

    let pdfDoc=null;

    function generarPDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit:"mm", format:"a4" });
      addHeaderFooter(doc);

      // Datos
      const fecha          = document.getElementById('fecha').value;
      const provincia      = document.getElementById('provincia').value;
      const nombreConvenio = document.getElementById('nombreConvenio').value;
      const numeroConvenio = document.getElementById('numeroConvenio').value;

      const cuerpoNota     = document.getElementById('cuerpoNota').value;

      const auxiliar       = document.getElementById('auxiliar').value;
      const referente      = document.getElementById('referente').value;
      const subgerente     = document.getElementById('subgerente').value;
      const firmante       = document.getElementById('firmante').value;
      const firmanteEmail  = document.getElementById('firmanteEmail').value;

      const clona          = document.getElementById('clona').value;
      const conveniosClona = document.getElementById('conveniosClona').value;
      const numerosTA      = document.getElementById('numerosTA').value;

      let y = { value: topY() };
      const CONTENT_W = PAGE_W - MARGIN_X*2;

      // ===== SecciÃ³n 1: Encabezado de datos (solo valores) =====
      doc.setFontSize(12);
      doc.setFont(undefined, "normal");
      textBlock(doc, fecha,          CONTENT_W, y);
      textBlock(doc, provincia,      CONTENT_W, y);
      textBlock(doc, nombreConvenio, CONTENT_W, y);
      textBlock(doc, numeroConvenio, CONTENT_W, y);

      // separador visual
      ensureSpace(doc, 6, y);
      doc.setDrawColor(200); doc.setLineWidth(0.3);
      doc.line(MARGIN_X, y.value, PAGE_W - MARGIN_X, y.value);
      y.value += 6;

      // ===== SecciÃ³n 2: Cuerpo de la Nota =====
      doc.setFontSize(12);
      textBlock(doc, cuerpoNota, CONTENT_W, y, 5);

      // separador visual
      ensureSpace(doc, 6, y);
      doc.setDrawColor(220); doc.setLineWidth(0.3);
      doc.line(MARGIN_X, y.value, PAGE_W - MARGIN_X, y.value);
      y.value += 6;

      // ===== SecciÃ³n 3: Firmantes (solo valores presentes) =====
      doc.setFontSize(12);
      textBlock(doc, auxiliar,      CONTENT_W, y);
      textBlock(doc, referente,     CONTENT_W, y);
      if((subgerente||"").trim()!=="") textBlock(doc, subgerente, CONTENT_W, y);
      textBlock(doc, firmante,      CONTENT_W, y);
      if((firmanteEmail||"").trim()!=="") textBlock(doc, firmanteEmail, CONTENT_W, y);

      // ===== SecciÃ³n 4: CLONA y TA (mÃ¡s chico, al final) =====
      y.value += 2;
      doc.setFontSize(10); // tipografÃ­a mÃ¡s chica
      if(clona === "SI" && (conveniosClona||"").trim()!==""){
        textBlock(doc, conveniosClona, CONTENT_W, y, 4.5);
      }
      if((numerosTA||"").trim()!==""){
        textBlock(doc, numerosTA, CONTENT_W, y, 4.5);
      }

      pdfDoc = doc;
      document.getElementById('preview').style.display = 'block';
      document.getElementById('preview').scrollIntoView({ behavior:'smooth' });
    }

    function descargarPDF(){
      if(pdfDoc){
        const numero = (document.getElementById('numeroConvenio').value || "").replace(/[^a-zA-Z0-9]/g,"_");
        pdfDoc.save(`NotaSignatura_${numero || 'sin_numero'}.pdf`);
      }
    }

    // Botones inline
    window.generarPDF = generarPDF;
    window.descargarPDF = descargarPDF;
  </script>
</body>
</html>
